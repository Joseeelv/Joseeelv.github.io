First, we use `ping` to check if we have a connection to the machine and identify the OS.

<div style="text-align: center;">
  <img src="/images/Rooms/HTB/Code/2.png" alt="Checking Connection" style="width:100%; max-width:inherit;">
</div>

Let's use _Nmap_ to find out the machine's running services & open ports:

**Port Scanning:**

<div style="text-align: center;">
<img src="/images/Rooms/HTB/Code/3.png" alt="Port Scanning" style="width:100%; max-width:inherit;">
</div>

**Service Scanning:**

<div style="text-align: center;">
<img src="/images/Rooms/HTB/Code/4.png" alt="Service Scanning" style="width:100%; max-width:inherit;">
</div>

Reveals services running on open ports: <code>SSH</code> (22) and <code>HTTP</code> (5000).

<div style="text-align: center;">
  <img src="/images/Rooms/HTB/Code/5.png" style="width:100%; max-width:inherit;">
</div>

This is the webpage.

As we can see, this web is a Python code interpreter, so we can try executing code using the `os` library:

<div style="text-align: center;">
  <img src="/images/Rooms/HTB/Code/6.png" style="width:100%; max-width:inherit;">
</div>

Certain keywords are blocked, so we need to find an alternative.

Let's perform fuzzing to discover more:

```bash
wfuzz -c --hc 404 --hl=99 -w [wordlist] [http://10.10.11.62:5000/FUZZ](http://10.10.11.62:5000/FUZZ)
```

Results:

<div style="text-align: center;">
  <img src="/images/Rooms/HTB/Code/7.png" style="width:100%; max-width:inherit;">
</div>

Nothing relevant was found.

The key lies in the Python code interpreter.

We can use [Python exceptions](https://docs.python.org/3/library/exceptions.html) to gather information. By executing `raise Exception(globals())`, we find a database in the output:

```bash
SQLAlchemy sqlite:////home/app-production/app/instance/database.db
```

Now, we can extract information from the database by running the following script in the Python interpreter to retrieve usernames and passwords:

```bash
users = db.session.query(User).all()
for user in users:
    print(user.username, user.password)
```

The passwords are hashed, so we use `hash-identifier` to identify the hash type:

<div style="text-align: center;">
  <img src="/images/Rooms/HTB/Code/8.png" style="width:100%; max-width:inherit;">
</div>

They are **MD5**, which is vulnerable to cracking. Let's crack them using `hashcat`:

```bash
hashcat -a 0 -m 0 [hash] [wordlist]
```

With the obtained credentials, we attempt to log in via SSH, and indeed, we can log in as martin:

<div style="text-align: center;">
  <img src="/images/Rooms/HTB/Code/9.png" style="width:100%; max-width:inherit;">
</div>

Now, let's find a way to escalate privileges.

First, check what the user can do with `sudo -l`:

<div style="text-align: center;">
  <img src="/images/Rooms/HTB/Code/10.png" style="width:100%; max-width:inherit;">
</div>

We can execute a script `backup.sh` as sudo. When executed, it requires a `task.json` file:

<div style="text-align: center;">
  <img src="/images/Rooms/HTB/Code/11.png" style="width:100%; max-width:inherit;">
</div>

Content of `task.json`:

<div style="text-align: center;">
  <img src="/images/Rooms/HTB/Code/12.png" style="width:100%; max-width:inherit;">
</div>

Our first goal is to find the `user.txt` flag. Navigating through directories, we notice that we don't have access to `/home/app-production/` and can't find the flag. So, we modify

<div style="text-align: center;">
  <img src="/images/Rooms/HTB/Code/13.png" style="width:100%; max-width:inherit;">
</div>

We add the flag to the JSON file to see if we can retrieve it during the backup process.

<div style="text-align: center;">
  <img src="/images/Rooms/HTB/Code/14.png" alt="User Flag" style="width:100%; max-width:inherit;">
</div>

We have successfully obtained the user flag.

Root Flag is located in the `/root` directory. Let's try to access it by modifying the `task.json` file again.

<div style="text-align: center;">
  <img src="/images/Rooms/HTB/Code/15.png" style="width:100%; max-width:inherit;">
</div>

Oh.. It tells us that only the directories **/home** and **/var** are valid. One way to bypass this would be through path traversal where we indicate one of the two allowed directories and then insert the root directory. Let's try it:

<div style="text-align: center;">
  <img src="/images/Rooms/HTB/Code/16.png" alt="Root Flag" style="width:100%; max-width:inherit;">
</div>

It has worked, and we have obtained the root flag.

---

<div style="text-align: center;">
  <a href="https://www.hackthebox.com/achievement/machine/1157775/653" target="_blank">
    <img src="/images/Rooms/HTB/Code/17.png" alt="Hack The Box Achievement" style="width:100%; max-width:inherit;">
  </a>
</div>
