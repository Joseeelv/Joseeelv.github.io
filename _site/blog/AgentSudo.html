<!DOCTYPE html>
<html>
<head>
  <head>
    <!-- Include Meta Tags Here -->
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1 user-scalable=no, shrink-to-fit=no">
<meta content='#000000' name='theme-color'/>
<meta name="keywords" content="Site, Template, Theme">
<title>CyberWiki | Agent Sudo</title>

<!-- Open Graph general (Facebook, Pinterest & Google+) -->
<meta name="og:title" content="CyberWiki | Agent Sudo">
<meta name="og:description" content="You found a secret server located under the deep sea. Your task is to hack inside the server and reveal the truth.">
<meta name="og:image" content="../assets/images/Rooms/AgentSudo/agentsudo.png">
<meta name="og:image:alt" content="CyberWiki | Agent Sudo">
<meta name="og:url" content="http://localhost:4000/blog/AgentSudo">
<meta name="article:author" content="https://www.facebook.com/">
<meta name="og:site_name" content="CyberWiki | Agent Sudo">
<meta name="og:type" content="website">
<!-- Twitter -->
<meta property="twitter:card" content="summary_large_image"/>
<meta name="twitter:title" content="CyberWiki | Agent Sudo">
<meta name="twitter:description" content="You found a secret server located under the deep sea. Your task is to hack inside the server and reveal the truth.">
<meta name="twitter:site" content="@">
<meta name="twitter:creator" content="@">
<meta name="twitter:image:src" content="../assets/images/Rooms/AgentSudo/agentsudo.png">
<!-- Search Engine -->
<meta name="description" content="You found a secret server located under the deep sea. Your task is to hack inside the server and reveal the truth.">
<meta name="image" content="../assets/images/Rooms/AgentSudo/agentsudo.png">
<!-- Schema.org for Google -->
<meta itemprop="name" content="CyberWiki | Agent Sudo">
<meta name="author" content="Jose Luis Venega"/>
<meta itemprop="description" content="You found a secret server located under the deep sea. Your task is to hack inside the server and reveal the truth.">
<meta itemprop="image" content="../assets/images/Rooms/AgentSudo/agentsudo.png">

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id="></script>
<script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
        dataLayer.push(arguments);
    }
    gtag('js', new Date());

    gtag('config', '');
</script>
    <title>CyberWiki</title>
    <link rel="stylesheet" href="/assets/css/style.css">
      <!-- Incluye el CSS de Prism.js -->
    <link rel="stylesheet" href="../prism.css">
    <script src="https://kit.fontawesome.com/6a97161b76.js" crossorigin="anonymous"></script>
    <link rel="shortcut icon" href="/assets/images/favicon.png" type="image/x-icon">
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            var titleElement = document.getElementById('page-title');
            var icon = "/assest/images/favicon.png"; // Puedes usar cualquier emoji o icono aquí
            titleElement.textContent = icon + " " + titleElement.textContent;
        });
    </script>
</head>
</head>



<body>
  <nav class="navbar is-black is-fixed-top" role="navigation" aria-label="main navigation" id="navbar">
    <div class="container">

        <!-- logo or branding image on left side -->
       
        <!-- Logo o imagen de marca en el lado izquierdo -->
        <div class="navbar-brand">
            <a class="navbar-item"
            href="http://localhost:4000/">
            <img src="/assets/images/favicon.png" alt="Site Icon" style="width: 24px; height: 24px; vertical-align: middle;">
                <i class="/assest/images/favicon.png"></i> <!-- Icono  -->
                <strong>CyberWiki</strong>
            </a>
            <div class="navbar-burger" data-target="navbar-menu">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>

        <!-- children of navbar-menu must be navbar-start and/or navbar-end -->
        <div class="navbar-menu has-background-black" id="navbar-menu">
            <!-- navbar items | left side -->
            <!-- <div class="navbar-start">
            </div> -->
            <!-- navbar items | right side -->
            <div class="navbar-end">
                <a class="navbar-item "
                    href="http://localhost:4000/">HOME</a>
                <a class="navbar-item" href="http://localhost:4000/#about">ABOUT</a>
                <a class="navbar-item" href="http://localhost:4000/#contact">CONTACT</a>
                <a class="navbar-item "
                    href="http://localhost:4000/blog">WRITE-UPs</a>
                <a class="navbar-item "
                    href="http://localhost:4000/project">LABS</a>
                <!-- <div class="navbar-item has-dropdown is-hoverable">
    <a class="navbar-link">
        MORE
    </a>
    <div class="navbar-dropdown has-background-black is-left">
        
        
        
        
        
        
        
        
        <a href="http://localhost:4000/project"
            class="navbar-item has-text-grey-light ">
            Projects
        </a>
        
        
        
        <a href="http://localhost:4000/test-page"
            class="navbar-item has-text-grey-light ">
            Test Page
        </a>
        
         -->
        <!-- <hr class="navbar-divider">
    <a class="navbar-item">
      Report an issue
    </a> -->
    <!-- </div>
</div> -->
            </div>
        </div>
    </div>
</nav>
<!-- Bulma Navbar JS -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        /* Get all "navbar-burger" elements */
        var $navbarBurgers = Array.prototype.slice.call(document.querySelectorAll('.navbar-burger'), 0);
        /* Check if there are any navbar burgers */
        if ($navbarBurgers.length > 0) {
            /* Add a click event on each of them */
            $navbarBurgers.forEach(function ($el) {
                $el.addEventListener('click', function () {
                    /* Get the target from the "data-target" attribute */
                    var target = $el.dataset.target;
                    var $target = document.getElementById(target);
                    /* Toggle the class on both the "navbar-burger" and the "navbar-menu" */
                    $el.classList.toggle('is-active');
                    $target.classList.toggle('is-active');
                });
            });
        }
    });
</script>
  <section class="hero is-fullheight has-text-centered" id="post">
    <div class="hero-body">
      <div class="container">
        <a href="/blog/AgentSudo" class="has-text-black" id="title">
          <h1 class="title has-text-centered is-2 has-text-weight-semibold ">Agent Sudo</h1>
        </a>
        <hr class="has-background-black">
        <div class="columns is-variable is-5 has-text-centered">
          <div class="column is-6">
            <div style="text-align: center; ">
              <img src="../assets/images/Rooms/AgentSudo/agentsudo.png" alt="Agent Sudo" id="post-image">
            </div>
          </div>
          <div class="subtitle column is-5 has-text-left-desktop has-text-left-fullhd has-text-left-tablet has-text-center-mobile" style="text-align: left;" ">
            
            <p id="description" class="content is-small has-text-weight-medium is-uppercase">
              You found a secret server located under the deep sea. Your task is to hack inside the server and reveal the truth.
              <!-- Enlace añadido aquí -->
              <p class="subtitle is-uppercase is-6 has-text-weight-normal has-text-black-ter">LAB LINK: 
                <b><a href="https://tryhackme.com/room/agentsudoctf" target="page.enlace">Agent Sudo</a></b>
              </p>
                
              <p class="subtitle is-6 is-uppercase has-text-weight-normal has-text-black-ter">LAB difficulty: 
                <b>Easy</b>
              </p>
            <p class="subtitle is-6 is-uppercase has-text-weight-normal has-text-black-ter">Published on
              <b>August 02, 2024</b> by <a href="https://github.com/Joseeelv" target="_blank"><b class="has-text-link"><u>Jose Luis Venega</u></b>
              </a>
            </p><p class="subtitle is-uppercase">
              <i class="fas fa-tags"></i>
              
              
              <span class="tag is-link">Enumeration</span>
              
              
              <span class="tag is-link">Exploit</span>
              
              
              <span class="tag is-link">Brute force</span>
              
              
              <span class="tag is-link">Hash cracking</span>
              
              
            </p><!-- <p class="subtitle is-uppercase"><i class="fas fa-clock"></i> <b class="has-text-link">
                5 min
              </b>READ</p> --></div>
        </div>
        <div class="content has-text-justified-desktop has-text-justified-fullhd has-text-justified has-text-justified-tablet has-text-left-mobile">
          <p><h1 id="task-1-author-note">Task 1: Author note</h1>
<p>Task 1 only tells us to deploy the machine</p>

<h1 id="task-2-enumerate">Task 2: Enumerate</h1>

<p>This task is about gathering important information from the machine.</p>

<p>To do this, we will first perform a scan of the machine`s ports in order to see which ones are open and which protocols are using them (very important later on).</p>

<p>Using the following command  → <code class="language-plaintext highlighter-rouge">nmap -p- -v &lt;ip_target&gt;</code> we get all the ports that are open.</p>

<p>Now, we will use the following command → <code class="language-plaintext highlighter-rouge">nmap -sC -sV -p&lt;ports&gt; &lt;ip_target&gt;</code></p>

<div style="text-align: center; ">
    <img src="../assets/images/Rooms/AgentSudo/Untitled.png" alt="Untitled" onclick="openModal(this.src )" />
</div>

<p>As you can see, we get information about open ports → services, version, status…</p>

<p>As a conclusion we have found that there are <strong>3 open ports (21, 22, 80).</strong></p>

<p>Having port 80 open means that it is using <em>HTTP</em> protocol, so we are going to make the request <code class="language-plaintext highlighter-rouge">http://&lt;ip_target&gt;</code>.</p>

<div style="text-align: center;">
    <img src="../assets/images/Rooms/AgentSudo/Untitled1.png" alt="Untitled" onclick="openModal(this.src)" />
</div>

<p>Hmm, we have found a web page.. What will it contain?</p>

<p>Having accessed a web page , we can perform a directory search on it. To do this, let’s do <em>web fuzzing</em> using the following command  → <code class="language-plaintext highlighter-rouge">gobuster dir --url &lt;ip_target&gt; -w /path_wordlist</code>.</p>

<div style="text-align: center;">
    <img src="../assets/images/Rooms/AgentSudo/Untitled2.png" alt="Untitled" onclick="openModal(this.src)" />
</div>

<p>NO luck, there are no hidden directories.</p>

<p>However, if we go back to the web page, we see information about our <em>codename</em> which is <strong>user-agent</strong>.</p>

<p>But that’s not all, we can find out who this <em>Agent R</em> is, let’s try spoofing with the <code class="language-plaintext highlighter-rouge">curl</code> command, where <code class="language-plaintext highlighter-rouge">-A</code> will be the <em>user-agent</em> and <code class="language-plaintext highlighter-rouge">-L</code> follows any redirection.</p>

<div style="text-align: center;">
    <img src="../assets/images/Rooms/AgentSudo/Untitled3.png" alt="Untitled" onclick="openModal(this.src)" />
</div>

<p>It tell us that there are 25 employees, so let’s keep checking for B, C, so on, until we find something different but still valid.</p>

<div style="text-align: center;">
    <img src="../assets/images/Rooms/AgentSudo/Untitled4.png" alt="Untitled" onclick="openModal(this.src)" />
</div>

<p>Wow a weak password, let’s look for it.</p>

<p>When we got the <em>user-agent</em> ‘C’. we find a different message, where it says <em>Attention chris</em>.
Great, now we have an username (<strong>Chris</strong>) whose password is weak.</p>

<h1 id="task-3-hash-cracking-and-brute-force">Task 3: Hash cracking and brute-force</h1>

<p>If we remember, earlier we got several services that the machine is using.</p>

<p>If we combine that with the fact that we have an username, we can make a connection to one of the services.</p>

<p>When we make a <em>FTP</em> connection it asks for a password. So, if we have the username, and using the tool called <code class="language-plaintext highlighter-rouge">Hydra</code> together with a <code class="language-plaintext highlighter-rouge">wordlist</code>, we will obtain the username password by brute force.</p>

<div style="text-align:center;">
 <div class="code-container">
    <div class="code-header">
      Bash
      <button class="copy-button" data-code="bash">Copy</button>
    </div>
    <pre><code class="language-bash">hydra -l chris -P /path_to_wordlist ftp:://machine_IP</code></pre>
  </div>
</div>

<p>The parameters of the above command are → <code class="language-plaintext highlighter-rouge">-l</code> (Login name), <code class="language-plaintext highlighter-rouge">-P</code> (password or list), <code class="language-plaintext highlighter-rouge">ftp</code> (service to crack).</p>

<div style="text-align: center;">
    <img src="../assets/images/Rooms/AgentSudo/a.png" alt="Untitled" onclick="openModal(this.src)" />
</div>

<p>Bingo, using the rockyou wordlist we got the password of the user chris.</p>

<p>Thanks to this, we can perform the <em>FTP</em> connection.</p>

<p>Now that we are inside, we m list the files with the command → <code class="language-plaintext highlighter-rouge">ls</code>; if we use <code class="language-plaintext highlighter-rouge">ls -la</code> we can see hidden directories:</p>

<div style="text-align: center;">
    <img src="../assets/images/Rooms/AgentSudo/Untitled5.png" alt="Untitled" onclick="openModal(this.src)" />
</div>

<p>There are 3 files, what we can do with them?</p>

<p><em>FTP</em> protocol offers us a way to download files and it is by using the command <code class="language-plaintext highlighter-rouge">mget </code>, where <code class="language-plaintext highlighter-rouge">*</code> means all files.</p>

<p>These files will be downloaded to our current directory, so lest’s open the ‘.txt’ file and we will see that it indicates that the images contain an hidden password.</p>

<p>To extract hidden information from an image we can use two tools, if the file extension is ‘<em>.png</em>’  → <code class="language-plaintext highlighter-rouge">binwalk -e</code>, it it is ‘<em>.jpg</em>’ → <code class="language-plaintext highlighter-rouge">steghide</code>.</p>

<div style="text-align: center;">
    <img src="../assets/images/Rooms/AgentSudo/Untitled6.png" alt="Untitled" onclick="openModal(this.src)" />
</div>

<p>Great, we have an .zip to extract.</p>

<p>As we know, the .zip obtained is encrypted, we will make use of the tools of <em>John The Ripper</em> in order to get the password.</p>

<p>Commands to use → <code class="language-plaintext highlighter-rouge">zip2john</code> y <code class="language-plaintext highlighter-rouge">john</code></p>

<div style="text-align: center;">
    <img src="../assets/images/Rooms/AgentSudo/b.png" alt="Untitled" onclick="openModal(this.src)" />
</div>

<p>Voila, we now have the password for ‘.zip’ file.</p>

<p>We will found an ‘.txt’ file inside the ‘.zip’, so we proceed to open it.</p>

<div style="text-align: center;">
    <img src="../assets/images/Rooms/AgentSudo/c.png" alt="Untitled" onclick="openModal(this.src)" />
</div>

<p>It tell us to send the image to a user, but it is encrypted. To decrypt it, we will use a tool from internet: <a href="https://gchq.github.io/CyberChef/">CyberChef</a>.</p>

<p>Now, we focus on the ‘.jpg’ file.</p>

<div style="text-align: center;">
    <img src="../assets/images/Rooms/AgentSudo/d.png" alt="Untitled" onclick="openModal(this.src)" />
</div>

<p>We read  the ‘.txt’ returned by the ‘.jpg’ file and found an <strong>ssh password</strong>.</p>

<h1 id="task-4-capture-the-user-flag">Task 4: Capture the user flag</h1>

<p>Now that we have both the username and password, we can perform an <em>ssh</em> connection with those credentials → <code class="language-plaintext highlighter-rouge">ssh username@ip_target</code>.</p>

<div style="text-align: center;">
    <img src="../assets/images/Rooms/AgentSudo/f.png" alt="Untitled" onclick="openModal(this.src)" />
</div>

<p>Inside the machine, we list the directories, and BOOM we get the user flag.</p>

<h1 id="task-5-privilege-escalation">Task 5: Privilege escalation</h1>

<p>As we already have the user flag, we will now look for the root flag. For this we will have to perform a privilege escalation.</p>

<p>First of all, we will check the commands that James can execute as root using the command → <code class="language-plaintext highlighter-rouge">sudo -l</code>.</p>

<div style="text-align: center;">
    <img src="../assets/images/Rooms/AgentSudo/Untitled7.png" alt="Untitled" onclick="openModal(this.src)" />
</div>

<p>Indeed, it has: <em>(ALL, !root) /bin/bash</em>.</p>

<div style="text-align: center;">
    <img src="../assets/images/Rooms/AgentSudo/Untitled8.png" alt="Untitled" onclick="openModal(this.src)" />
</div>

<p>If we search on internet information about the exploit (CVE, version, ..) we will find a way to execute the exploit, but usually by running the command as such, in our case <code class="language-plaintext highlighter-rouge">sudo -u root /bin/bash</code>, it will execute without problems.</p>

<table>
  <tr>
    <td style="vertical-align:top">
      <div style="text-align: center;">
          <img src="../assets/images/Rooms/AgentSudo/Untitled9.png" alt="Untitled" onclick="openModal(this.src)" />
      </div>
    </td>
    <td style="vertical-align:top">
      <div style="text-align: center;">
          <img src="../assets/images/Rooms/AgentSudo/Untitled10.png" alt="Untitled" onclick="openModal(this.src)" />
      </div>
    </td>
  </tr>
</table>

<p>We get root privileges, which give us the freedom to navigate between directories.</p>

<div style="text-align: center;">
    <img src="../assets/images/Rooms/AgentSudo/g.png" alt="Untitled" onclick="openModal(this.src)" />
</div>

<p>Finally, in the root directory there is a file called <em>root.txt</em> which contain the flag.</p>

<hr />
</p>
        </div>
        
        <div class="disqus-comments" id="disqus_thread"></div>
        
      </div>
    </div>
  </section>
  <footer id="footer">
    <!--Footer Button-->
    <div class="container has-text-centered has-background-grey-darker" id="backtotop">
        <a class="has-text-white" onclick="window.scroll(0,0)">BACK TO TOP</a>
    </div>
    <!--Footer Main Section-->
    <div class="has-background-grey-darker">
        <div class="container columns">
            <!--Name Section-->
            <div class="column has-text-left-desktop has-text-centered-mobile">
                <a href="http://localhost:4000/#about">
                    <div class="columns">
                        <div class="column is-one-fifth-desktop is-one-fifth-fullhd is-one-quarter-tablet">
                            <figure class="image is-64x64">
                                <img class="is-rounded" src="/assets/images/me.png">
                            </figure>
                        </div>
                        <div class="column is-marginless">
                            <h5 class="has-text-grey-lighter">Jose Luis Venega</h5>
                            <div class="content has-text-grey">
                                <p>Hello, I am Jose Luis Venega Sánchez, a student of Computer Science at t...</p>
                            </div>
                        </div>
                    </div>
                </a>
            </div>

            <!--Link Section
            <div class="column has-text-white">
                <h3>More Links</h3>
                
                <li>
                    <a target="_blank" href="http://localhost:4000/feed.xml">Subscribe via RSS</a>
                </li>
            </div> -->

            <!--Blog-post Section-->
            <div class="column has-text-white">
                <h3>Recent Posts</h3>
                
                <li>
                    <a href="http://localhost:4000/blog/ChillHack">ChillHack</a>
                </li>
                
                <li>
                    <a href="http://localhost:4000/blog/DNS">Sistema de Nombres de Dominio "DNS"</a>
                </li>
                
                <li>
                    <a href="http://localhost:4000/blog/Startup">Start-up</a>
                </li>
                
            </div>
        </div>
    </div>
    <!-- <div class="has-background-black has-text-centered has-text-white" id="credits">
        <i class="far fa-copyright"></i> 2024 | <a href="https://github.com/thedevslot/WhatATheme" target="_blank" rel="noopener noreferrer">WhatATheme</a> - A Theme made with <i class="fas fa-heart has-text-danger"></i> by <a href="https://www.twitter.com/thedevslot" target="_blank" rel="noopener noreferrer">TheDevsLot</a> Powered by <a href="https://jekyllrb.com/" target="_blank">Jekyll</a>
    </div> -->
</footer>

  <!-- Modal -->
  <div id="myModal" class="modal">
    <span class="close" onclick="closeModal()">&times;</span>
    <img class="modal-content" id="img01">
  </div>
 <!-- Prism.js Script -->
  <script src="../prism.js"></script>
  <script>
    function copyToClipboard(event) {
    // Obtén el botón que fue clickeado
    const button = event.target;

    // Encuentra el bloque de código asociado al botón
    const codeContainer = button.closest('.code-container');
    const codeElement = codeContainer.querySelector('code');
    
    if (!codeElement) {
        console.error('No se encontró el elemento <code> para copiar.');
        return;
    }

    const code = codeElement.textContent;

    // Usa la API moderna de Clipboard para copiar el texto
    navigator.clipboard.writeText(code).then(() => {
        // Cambia el texto del botón a 'Copiado'
        button.textContent = 'Copied!';

        // Opcional: Restaura el texto del botón después de un breve período
        setTimeout(() => {
            button.textContent = 'Copy';
        }, 2000); // 2000 ms = 2 segundos

    }).catch(err => {
        // Maneja errores (opcional)
        console.error('Error al copiar al portapapeles: ', err);
    });
}
        document.querySelectorAll('.copy-button').forEach(button => {
          button.addEventListener('click', copyToClipboard);
        });
      function openModal(imgSrc) {
      var modal = document.getElementById("myModal");
      var modalImg = document.getElementById("img01");

      modal.style.display = "block";
      setTimeout(function() {
        modal.classList.add('show');
      }, 10); // Delay to trigger the animation
      modalImg.src = imgSrc;
    }

    function closeModal(event) {
      if (event) event.stopPropagation(); // Prevents closing when clicking the close button
      var modal = document.getElementById("myModal");
      modal.classList.remove('show');
      setTimeout(function() {
        modal.style.display = "none";
      }, 300); // Match this duration with the CSS animation duration
    }

    // Close modal when clicking outside the content
    window.onclick = function(event) {
      var modal = document.getElementById("myModal");
      if (event.target == modal) {
        closeModal();
      }
    }
  </script>
</body>
</html>
