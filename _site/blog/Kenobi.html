<!DOCTYPE html>
<html>
<head>
  <head>
    <!-- Include Meta Tags Here -->
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1 user-scalable=no, shrink-to-fit=no">
<meta content='#000000' name='theme-color'/>
<meta name="keywords" content="Site, Template, Theme">
<title>CyberWiki | Kenobi</title>

<!-- Open Graph general (Facebook, Pinterest & Google+) -->
<meta name="og:title" content="CyberWiki | Kenobi">
<meta name="og:description" content="En esta room vamos a enumerar y explotar vulnerabilidades de algunos servicios (Samba, FTP, entre otros), con el fin de obtener acceso a la máquina y poder escalar privilegios para obtener las flags que se encuentran en el servidor.">
<meta name="og:image" content="../assets/images/Rooms/Kenobi/kenobi.png">
<meta name="og:image:alt" content="CyberWiki | Kenobi">
<meta name="og:url" content="http://localhost:4000/blog/Kenobi">
<meta name="article:author" content="https://www.facebook.com/">
<meta name="og:site_name" content="CyberWiki | Kenobi">
<meta name="og:type" content="website">
<!-- Twitter -->
<meta property="twitter:card" content="summary_large_image"/>
<meta name="twitter:title" content="CyberWiki | Kenobi">
<meta name="twitter:description" content="En esta room vamos a enumerar y explotar vulnerabilidades de algunos servicios (Samba, FTP, entre otros), con el fin de obtener acceso a la máquina y poder escalar privilegios para obtener las flags que se encuentran en el servidor.">
<meta name="twitter:site" content="@">
<meta name="twitter:creator" content="@">
<meta name="twitter:image:src" content="../assets/images/Rooms/Kenobi/kenobi.png">
<!-- Search Engine -->
<meta name="description" content="En esta room vamos a enumerar y explotar vulnerabilidades de algunos servicios (Samba, FTP, entre otros), con el fin de obtener acceso a la máquina y poder escalar privilegios para obtener las flags que se encuentran en el servidor.">
<meta name="image" content="../assets/images/Rooms/Kenobi/kenobi.png">
<!-- Schema.org for Google -->
<meta itemprop="name" content="CyberWiki | Kenobi">
<meta name="author" content="Jose Luis Venega"/>
<meta itemprop="description" content="En esta room vamos a enumerar y explotar vulnerabilidades de algunos servicios (Samba, FTP, entre otros), con el fin de obtener acceso a la máquina y poder escalar privilegios para obtener las flags que se encuentran en el servidor.">
<meta itemprop="image" content="../assets/images/Rooms/Kenobi/kenobi.png">

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id="></script>
<script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
        dataLayer.push(arguments);
    }
    gtag('js', new Date());

    gtag('config', '');
</script>
    <title>CyberWiki</title>
    <link rel="stylesheet" href="/assets/css/style.css">
      <!-- Incluye el CSS de Prism.js -->
    <link rel="stylesheet" href="../prism.css">
    <script src="https://kit.fontawesome.com/6a97161b76.js" crossorigin="anonymous"></script>
    <link rel="shortcut icon" href="/assets/images/favicon.png" type="image/x-icon">
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            var titleElement = document.getElementById('page-title');
            var icon = "/assest/images/favicon.png"; // Puedes usar cualquier emoji o icono aquí
            titleElement.textContent = icon + " " + titleElement.textContent;
        });
    </script>
</head>
</head>



<body>
  <nav class="navbar is-black is-fixed-top" role="navigation" aria-label="main navigation" id="navbar">
    <div class="container">

        <!-- logo or branding image on left side -->
       
        <!-- Logo o imagen de marca en el lado izquierdo -->
        <div class="navbar-brand">
            <a class="navbar-item"
            href="http://localhost:4000/">
            <img src="/assets/images/favicon.png" alt="Site Icon" style="width: 24px; height: 24px; vertical-align: middle;">
                <i class="/assest/images/favicon.png"></i> <!-- Icono  -->
                <strong>CyberWiki</strong>
            </a>
            <div class="navbar-burger" data-target="navbar-menu">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>

        <!-- children of navbar-menu must be navbar-start and/or navbar-end -->
        <div class="navbar-menu has-background-black" id="navbar-menu">
            <!-- navbar items | left side -->
            <!-- <div class="navbar-start">
            </div> -->
            <!-- navbar items | right side -->
            <div class="navbar-end">
                <a class="navbar-item "
                    href="http://localhost:4000/">HOME</a>
                <a class="navbar-item" href="http://localhost:4000/#about">ABOUT</a>
                <a class="navbar-item" href="http://localhost:4000/#contact">CONTACT</a>
                <a class="navbar-item "
                    href="http://localhost:4000/blog">WRITE-UPs</a>
                <a class="navbar-item "
                    href="http://localhost:4000/project">LABS</a>
                <!-- <div class="navbar-item has-dropdown is-hoverable">
    <a class="navbar-link">
        MORE
    </a>
    <div class="navbar-dropdown has-background-black is-left">
        
        
        
        
        
        
        
        
        <a href="http://localhost:4000/project"
            class="navbar-item has-text-grey-light ">
            Projects
        </a>
        
        
        
        <a href="http://localhost:4000/test-page"
            class="navbar-item has-text-grey-light ">
            Test Page
        </a>
        
         -->
        <!-- <hr class="navbar-divider">
    <a class="navbar-item">
      Report an issue
    </a> -->
    <!-- </div>
</div> -->
            </div>
        </div>
    </div>
</nav>
<!-- Bulma Navbar JS -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        /* Get all "navbar-burger" elements */
        var $navbarBurgers = Array.prototype.slice.call(document.querySelectorAll('.navbar-burger'), 0);
        /* Check if there are any navbar burgers */
        if ($navbarBurgers.length > 0) {
            /* Add a click event on each of them */
            $navbarBurgers.forEach(function ($el) {
                $el.addEventListener('click', function () {
                    /* Get the target from the "data-target" attribute */
                    var target = $el.dataset.target;
                    var $target = document.getElementById(target);
                    /* Toggle the class on both the "navbar-burger" and the "navbar-menu" */
                    $el.classList.toggle('is-active');
                    $target.classList.toggle('is-active');
                });
            });
        }
    });
</script>
  <section class="hero is-fullheight has-text-centered" id="post">
    <div class="hero-body">
      <div class="container">
        <a href="/blog/Kenobi" class="has-text-black" id="title">
          <h1 class="title has-text-centered is-2 has-text-weight-semibold ">Kenobi</h1>
        </a>
        <hr class="has-background-black">
        <div class="columns is-variable is-5 has-text-centered">
          <div class="column is-6">
            <div style="text-align: center; ">
              <img src="../assets/images/Rooms/Kenobi/kenobi.png" alt="Kenobi" id="post-image">
            </div>
          </div>
          <div class="subtitle column is-5 has-text-left-desktop has-text-left-fullhd has-text-left-tablet has-text-center-mobile" style="text-align: left;" ">
            
            <p id="description" class="content is-small has-text-weight-medium is-uppercase">
              En esta room vamos a enumerar y explotar vulnerabilidades de algunos servicios (Samba, FTP, entre otros), con el fin de obtener acceso a la máquina y poder escalar privilegios para obtener las flags que se encuentran en el servidor.
              <!-- Enlace añadido aquí -->
              <p class="subtitle is-uppercase is-6 has-text-weight-normal has-text-black-ter">LAB LINK: 
                <b><a href="https://tryhackme.com/r/room/kenobi" target="page.enlace">Kenobi</a></b>
              </p>
                
              <p class="subtitle is-6 is-uppercase has-text-weight-normal has-text-black-ter">LAB difficulty: 
                <b>Fácil</b>
              </p>
            <p class="subtitle is-6 is-uppercase has-text-weight-normal has-text-black-ter">Published on
              <b>August 06, 2024</b> by <a href="https://github.com/Joseeelv" target="_blank"><b class="has-text-link"><u>Jose Luis Venega</u></b>
              </a>
            </p><p class="subtitle is-uppercase">
              <i class="fas fa-tags"></i>
              
              
              <span class="tag is-link">Enumeración</span>
              
              
              <span class="tag is-link">Privilege Escalation</span>
              
              
              <span class="tag is-link">Exploit</span>
              
              
              <span class="tag is-link">Samba</span>
              
              
            </p><!-- <p class="subtitle is-uppercase"><i class="fas fa-clock"></i> <b class="has-text-link">
                5 min
              </b>READ</p> --></div>
        </div>
        <div class="content has-text-justified-desktop has-text-justified-fullhd has-text-justified has-text-justified-tablet has-text-left-mobile">
          <p><p>Primero de todo, vamos a realizar un escaneo de puertos de la ip de la máquina víctima:</p>

<div style="text-align: center; ">
  <table>
    <tr>
      <td>
        <div style="text-align: center; ">
         <img src="../assets/images/Rooms/Kenobi/Untitled.png" alt="Untitled" style="width:100%; max-width:700px;" onclick="openModal(this.src)" />
        </div>
      </td>
      <td>
        <div style="text-align: center; ">
          <img src="../assets/images/Rooms/Kenobi/Untitled 1.png" alt="Untitled" style="width:100%; max-width:900px;" onclick="openModal(this.src)" />
        </div>
      </td>
    </tr>
  </table>
</div>

<p>Vemos que tenemos en el puerto <em>21</em> un servicio <em>FTP</em> con una versión <strong>ProFTPD 1.3.5</strong>, en el puerto 445 un servicio de recursos compartidos <em>Samba</em>, además de un servicio <em>ssh</em> en el puerto 22 y también vemos que podemos consultar las monturas de la máquina víctima:</p>

<div style="text-align: center; ">
<img src="../assets/images/Rooms/Kenobi/Untitled 2.png" alt="Untitled" onclick="openModal(this.src)" />
</div>

<p>Si hacemos uso de <code class="language-plaintext highlighter-rouge">smbmap -H &lt;ip_maquina&gt;</code> podemos consultar los recursos compartidos y con <code class="language-plaintext highlighter-rouge">smbclient //ip_maquina/anonymoys -N</code> podemos navegar entre esos recursos y vemos que hay un fichero <code class="language-plaintext highlighter-rouge">log.txt</code> que vamos a proceder a descargar:</p>

<div style="text-align: center; ">
<img src="../assets/images/Rooms/Kenobi/Untitled 3.png" alt="Untitled" onclick="openModal(this.src)" />
</div>

<p>Con el comando <code class="language-plaintext highlighter-rouge">get</code>nos descargamos el fichero y lo abrimos en nuestra máquina con <code class="language-plaintext highlighter-rouge">cat nombre_fichero_descargado</code>:</p>

<div style="text-align: center; ">
<img src="../assets/images/Rooms/Kenobi/Untitled 4.png" alt="Untitled" onclick="openModal(this.src)" />
</div>

<p>Este fichero nos indica que hay un usuario “<em>kenobi</em>” que ha iniciado sesión mediante un <strong>id_rsa</strong> en una conexión <code class="language-plaintext highlighter-rouge">ssh</code>.</p>

<p>Si volvemos al escaneo que hemos hecho con Nmap, podemos ver que en el puerto 21 tenemos un servicio <em>FTP</em> que está usando ProFTPD en una versión 1.3.5 que puede ser vulnerable, por tanto, mediante la herramienta <code class="language-plaintext highlighter-rouge">searchsploit</code> podemos buscar vulnerabilidades del servicio.</p>

<div style="text-align: center; ">
<img src="../assets/images/Rooms/Kenobi/Untitled 5.png" alt="Untitled" onclick="openModal(this.src)" />
</div>

<p>En efecto, tiene vulnerabilidades y mediante la opción <code class="language-plaintext highlighter-rouge">-m</code> nos podemos descargar el exploit.</p>

<p>Si abrimos el fichero descargado, encontramos información sobre el exploit y vemos que este nos permite la copia de ficheros del servidor FTP entre directorios cualesquiera:</p>

<div style="text-align: center; ">
<img src="../assets/images/Rooms/Kenobi/1.png" alt="Untitled" onclick="openModal(this.src)" />
</div>

<p>Si nos conectamos al servicio ProFTPD con netcat y especificamos el puerto (en este caso 21), podremos copiarnos el fichero <code class="language-plaintext highlighter-rouge">id_rsa</code> en cualquier directorio, en este caso lo hacemos al directorio <code class="language-plaintext highlighter-rouge">/var/tmp</code> (que es una de las monturas del servidor).</p>

<div style="text-align: center; ">
<img src="../assets/images/Rooms/Kenobi/Untitled 6.png" alt="Untitled" onclick="openModal(this.src)" />
</div>

<p>Ahora vamos a obtener dicho fichero, para ello vamos al directorio <code class="language-plaintext highlighter-rouge">/mnt</code> de nuestra máquina y creamos una montura nueva:</p>

<div style="text-align: center; ">
<img src="../assets/images/Rooms/Kenobi/Untitled 7.png" alt="Untitled" onclick="openModal(this.src)" />
</div>

<p>Luego, como podemos ver, insertamos la montura que encontramos en el servidor en la que hemos creado mediante <code class="language-plaintext highlighter-rouge">mount &lt;ip_maquina_victima&gt;:/&lt;recurso_compartido&gt; /nuestra_montura</code>, donde <code class="language-plaintext highlighter-rouge">&lt;recurso_compartido&gt;</code> es la carpeta donde hemos movido previamente el fichero <strong>id_rsa</strong>.</p>

<p>Finalmente, si listamos la montura vemos que tenemos en nuestra máquina dicho fichero que podemos usar para realizar la conexión vía <code class="language-plaintext highlighter-rouge">ssh</code>.</p>

<p>Para ello, le damos permisos de lectura y procedemos a iniciar sesión vía ssh, con las credenciales (usuario <em>kenobi</em> y <strong>id_rsa</strong>):</p>

<div style="text-align: center; ">
<img src="../assets/images/Rooms/Kenobi/Untitled 8.png" alt="Untitled" onclick="openModal(this.src)" />
</div>

<p>Ahora, que estamos dentro del servidor vamos a buscar las flags, para ello vamos a navegar entre directorios, para ello realizamos un listado con <code class="language-plaintext highlighter-rouge">ls -l</code> y vemos que no nos hace falta buscar la flag, ya que esta se encuentra en el directorio donde estamos situados.</p>
<div style="text-align: center; ">
<img src="../assets/images/Rooms/Kenobi/1 1.png" alt="Untitled" onclick="openModal(this.src)" />
</div>

<p>Ahora nos piden la flag del root, para ello tenemos que escalar privilegios, esto lo hacemos porque aunque la encontremos no vamos a tener los privilegios necesarios para poder consultar su contenido.</p>

<p>Podemos escalar de privilegios de varias manera (<a href="https://joseeelv.github.io//blog/EPL">más información aquí</a>), como buscar los exploits del kernel, ver los comando que el usuario puede ejecutar como SUDO, ver los binarios que tienen el bit SUID activado (ya que siempre se ejecutan como root), entre otros..</p>

<div style="text-align: center; ">
<img src="../assets/images/Rooms/Kenobi/1 2.png" alt="Untitled" onclick="openModal(this.src)" />
</div>

<p>Vemos que no ha habido suerte a la hora de hacer <code class="language-plaintext highlighter-rouge">sudo -l</code>, asi que vamos a realizar un escaneo de los binarios con el bit SUID activado. Vemos que hemos encontrado un binario <code class="language-plaintext highlighter-rouge">/usr/bin/menu</code> sospechoso.</p>

<p>Si lo ejecutamos vemos que contiene un menú que ejecuta 3 comandos, estos 3 comandos siempre se ejecutan con privilegios root, debido a que tiene el bit SUID activado:</p>

<div style="text-align: center; ">
<img src="../assets/images/Rooms/Kenobi/Untitled 9.png" alt="Untitled" onclick="openModal(this.src)" />
</div>

<p>Como he comentado antes estos 3 comandos siempre se ejecutan como root, así que podemos aprovecharnos de eso, colando dicho binario en el <strong>PATH</strong>, es decir, vamos a realizar un <strong>PATH_Hijacking</strong>, hacemos esto porque si colamos un comando como lanzar una bash esta se ejecutará como root sin nosotros tener dicho privilegio.</p>

<div style="text-align: center; ">
<img src="../assets/images/Rooms/Kenobi/Untitled 10.png" alt="Untitled" onclick="openModal(this.src)" />
</div>

<p>Mostramos por pantalla el PATH y exportamos el directorio del binario al PATH y vemos que ya está incluido.</p>

<p>En este caso vamos a incluir una Shell de Bash dentro del comando <code class="language-plaintext highlighter-rouge">ifconfig</code> (comando número 3 del binario), esto lo hacemos mediante el comando <code class="language-plaintext highlighter-rouge">echo</code></p>

<div style="text-align: center; ">
<img src="../assets/images/Rooms/Kenobi/Untitled 11.png" alt="Untitled" onclick="openModal(this.src)" />
</div>

<p>Le damos todos los permisos y lo exportamos al PATH y lo ejecutamos y vemos que se ejecutó la Shell de Bash como root:</p>

<div style="text-align: center; ">
<img src="../assets/images/Rooms/Kenobi/1 3.png" alt="Untitled" onclick="openModal(this.src)" />
</div>

<p>Ahora que somos un usuario root, vamos a buscar la flag que nos falta (casi siempre, como en este caso se encuentra en el directorio <code class="language-plaintext highlighter-rouge">/root</code>).</p>

<div style="text-align: center; ">
<img src="../assets/images/Rooms/Kenobi/223.png" alt="Untitled" onclick="openModal(this.src)" />
</div>

<hr />
</p>
        </div>
        
        <div class="disqus-comments" id="disqus_thread"></div>
        
      </div>
    </div>
  </section>
  <footer id="footer">
    <!--Footer Button-->
    <div class="container has-text-centered has-background-grey-darker" id="backtotop">
        <a class="has-text-white" onclick="window.scroll(0,0)">BACK TO TOP</a>
    </div>
    <!--Footer Main Section-->
    <div class="has-background-grey-darker">
        <div class="container columns">
            <!--Name Section-->
            <div class="column has-text-left-desktop has-text-centered-mobile">
                <a href="http://localhost:4000/#about">
                    <div class="columns">
                        <div class="column is-one-fifth-desktop is-one-fifth-fullhd is-one-quarter-tablet">
                            <figure class="image is-64x64">
                                <img class="is-rounded" src="/assets/images/me.png">
                            </figure>
                        </div>
                        <div class="column is-marginless">
                            <h5 class="has-text-grey-lighter">Jose Luis Venega</h5>
                            <div class="content has-text-grey">
                                <p>Hello, I am Jose Luis Venega Sánchez, a student of Computer Engineering ...</p>
                            </div>
                        </div>
                    </div>
                </a>
            </div>

            <!--Link Section
            <div class="column has-text-white">
                <h3>More Links</h3>
                
                <li>
                    <a target="_blank" href="http://localhost:4000/feed.xml">Subscribe via RSS</a>
                </li>
            </div> -->

            <!--Blog-post Section-->
            <div class="column has-text-white">
                <h3>Recent Posts</h3>
                
                <li>
                    <a href="http://localhost:4000/blog/ChillHack">ChillHack</a>
                </li>
                
                <li>
                    <a href="http://localhost:4000/blog/DNS">Sistema de Nombres de Dominio "DNS"</a>
                </li>
                
                <li>
                    <a href="http://localhost:4000/blog/Startup">Start-up</a>
                </li>
                
            </div>
        </div>
    </div>
    <!-- <div class="has-background-black has-text-centered has-text-white" id="credits">
        <i class="far fa-copyright"></i> 2024 | <a href="https://github.com/thedevslot/WhatATheme" target="_blank" rel="noopener noreferrer">WhatATheme</a> - A Theme made with <i class="fas fa-heart has-text-danger"></i> by <a href="https://www.twitter.com/thedevslot" target="_blank" rel="noopener noreferrer">TheDevsLot</a> Powered by <a href="https://jekyllrb.com/" target="_blank">Jekyll</a>
    </div> -->
</footer>

  <!-- Modal -->
  <div id="myModal" class="modal">
    <span class="close" onclick="closeModal()">&times;</span>
    <img class="modal-content" id="img01">
  </div>
 <!-- Prism.js Script -->
  <script src="../prism.js"></script>
  <script>
    function copyToClipboard(event) {
    // Obtén el botón que fue clickeado
    const button = event.target;

    // Encuentra el bloque de código asociado al botón
    const codeContainer = button.closest('.code-container');
    const codeElement = codeContainer.querySelector('code');
    
    if (!codeElement) {
        console.error('No se encontró el elemento <code> para copiar.');
        return;
    }

    const code = codeElement.textContent;

    // Usa la API moderna de Clipboard para copiar el texto
    navigator.clipboard.writeText(code).then(() => {
        // Cambia el texto del botón a 'Copiado'
        button.textContent = 'Copied!';

        // Opcional: Restaura el texto del botón después de un breve período
        setTimeout(() => {
            button.textContent = 'Copy';
        }, 2000); // 2000 ms = 2 segundos

    }).catch(err => {
        // Maneja errores (opcional)
        console.error('Error al copiar al portapapeles: ', err);
    });
}
        document.querySelectorAll('.copy-button').forEach(button => {
          button.addEventListener('click', copyToClipboard);
        });
      function openModal(imgSrc) {
      var modal = document.getElementById("myModal");
      var modalImg = document.getElementById("img01");

      modal.style.display = "block";
      setTimeout(function() {
        modal.classList.add('show');
      }, 10); // Delay to trigger the animation
      modalImg.src = imgSrc;
    }

    function closeModal(event) {
      if (event) event.stopPropagation(); // Prevents closing when clicking the close button
      var modal = document.getElementById("myModal");
      modal.classList.remove('show');
      setTimeout(function() {
        modal.style.display = "none";
      }, 300); // Match this duration with the CSS animation duration
    }

    // Close modal when clicking outside the content
    window.onclick = function(event) {
      var modal = document.getElementById("myModal");
      if (event.target == modal) {
        closeModal();
      }
    }
  </script>
</body>
</html>
