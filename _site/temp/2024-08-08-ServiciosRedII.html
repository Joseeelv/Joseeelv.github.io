<!DOCTYPE html>
<html>
<head>
  <head>
    <!-- Include Meta Tags Here -->
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1 user-scalable=no, shrink-to-fit=no">
<meta content='#000000' name='theme-color'/>
<meta name="keywords" content="Site, Template, Theme">
<title>Jose's Portfolio | Servicios de red II</title>

<!-- Open Graph general (Facebook, Pinterest & Google+) -->
<meta name="og:title" content="Jose's Portfolio | Servicios de red II">
<meta name="og:description" content="El laboratorio tiene como objetivo enseñar la enumeración y explotación de tres protocolos de red; NFS (Network File System), SMTP (Simple Mail Transfer Protocol) y MySQL. Los participantes aprenderán a identificar vulnerabilidades y realizar ataques utilizando herramientas comunes en pruebas de penetración y administración de sistemas.">
<meta name="og:image" content="../assets/images/Labs/ServiciosRedII/srII.png">
<meta name="og:image:alt" content="Jose's Portfolio | Servicios de red II">
<meta name="og:url" content="http://localhost:4000/temp/2024-08-08-ServiciosRedII">
<meta name="article:author" content="https://www.facebook.com/">
<meta name="og:site_name" content="Jose's Portfolio | Servicios de red II">
<meta name="og:type" content="website">
<!-- Twitter -->
<meta property="twitter:card" content="summary_large_image"/>
<meta name="twitter:title" content="Jose's Portfolio | Servicios de red II">
<meta name="twitter:description" content="El laboratorio tiene como objetivo enseñar la enumeración y explotación de tres protocolos de red; NFS (Network File System), SMTP (Simple Mail Transfer Protocol) y MySQL. Los participantes aprenderán a identificar vulnerabilidades y realizar ataques utilizando herramientas comunes en pruebas de penetración y administración de sistemas.">
<meta name="twitter:site" content="@">
<meta name="twitter:creator" content="@">
<meta name="twitter:image:src" content="../assets/images/Labs/ServiciosRedII/srII.png">
<!-- Search Engine -->
<meta name="description" content="El laboratorio tiene como objetivo enseñar la enumeración y explotación de tres protocolos de red; NFS (Network File System), SMTP (Simple Mail Transfer Protocol) y MySQL. Los participantes aprenderán a identificar vulnerabilidades y realizar ataques utilizando herramientas comunes en pruebas de penetración y administración de sistemas.">
<meta name="image" content="../assets/images/Labs/ServiciosRedII/srII.png">
<!-- Schema.org for Google -->
<meta itemprop="name" content="Jose's Portfolio | Servicios de red II">
<meta name="author" content="Jose Luis Venega"/>
<meta itemprop="description" content="El laboratorio tiene como objetivo enseñar la enumeración y explotación de tres protocolos de red; NFS (Network File System), SMTP (Simple Mail Transfer Protocol) y MySQL. Los participantes aprenderán a identificar vulnerabilidades y realizar ataques utilizando herramientas comunes en pruebas de penetración y administración de sistemas.">
<meta itemprop="image" content="../assets/images/Labs/ServiciosRedII/srII.png">

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id="></script>
<script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
        dataLayer.push(arguments);
    }
    gtag('js', new Date());

    gtag('config', '');
</script>
    <title>Jose's Portfolio</title>
    <link rel="stylesheet" href="/assets/css/style.css">
      <!-- Incluye el CSS de Prism.js -->
    <link rel="stylesheet" href="../prism.css">
    <script src="https://kit.fontawesome.com/6a97161b76.js" crossorigin="anonymous"></script>

    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    
    <link rel="shortcut icon" href="/assets/images/favicon.png" type="image/x-icon">
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            var titleElement = document.getElementById('page-title');
            var icon = "/assest/images/favicon.png"; // Puedes usar cualquier emoji o icono aquí
            titleElement.textContent = icon + " " + titleElement.textContent;
        });
    </script>
</head>
</head>

<body>
  <nav class="navbar is-black is-fixed-top" role="navigation" aria-label="main navigation" id="navbar">
    <div class="container">

        <!-- logo or branding image on left side -->
       
        <!-- Logo o imagen de marca en el lado izquierdo -->
        <div class="navbar-brand">
            <a class="navbar-item"
                href="http://localhost:4000/">
                    <img src="/assets/images/favicon.png" 
                        alt="Site Icon" 
                        style="width: 24px; height: 24px; vertical-align: middle; margin-right: 8px;">
                    <i class="/assest/images/favicon.png"></i>
                    <strong>Jose's Portfolio</strong>
                </a>
            <div class="navbar-burger" data-target="navbar-menu">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>

        <!-- children of navbar-menu must be navbar-start and/or navbar-end -->
        <div class="navbar-menu has-background-black" id="navbar-menu">
            <!-- navbar items | left side -->
            <!-- <div class="navbar-start">
            </div> -->
            <!-- navbar items | right side -->
            <div class="navbar-end">
                <a class="navbar-item "
                    href="http://localhost:4000/">HOME</a>
                <a class="navbar-item" href="http://localhost:4000/#about">WHOAMI</a>
                <a class="navbar-item" href="http://localhost:4000/#contact">CONTACT</a>
                <a class="navbar-item "
                    href="http://localhost:4000/blog">MACHINES</a>
            </div>
        </div>
    </div>
</nav>
<!-- Bulma Navbar JS -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        /* Get all "navbar-burger" elements */
        var $navbarBurgers = Array.prototype.slice.call(document.querySelectorAll('.navbar-burger'), 0);
        /* Check if there are any navbar burgers */
        if ($navbarBurgers.length > 0) {
            /* Add a click event on each of them */
            $navbarBurgers.forEach(function ($el) {
                $el.addEventListener('click', function () {
                    /* Get the target from the "data-target" attribute */
                    var target = $el.dataset.target;
                    var $target = document.getElementById(target);
                    /* Toggle the class on both the "navbar-burger" and the "navbar-menu" */
                    $el.classList.toggle('is-active');
                    $target.classList.toggle('is-active');
                });
            });
        }
    });
</script>
  <section class="hero is-fullheight has-text-centered" id="post">
    <div class="hero-body">
      <div class="container">
        <a href="/temp/2024-08-08-ServiciosRedII" class="has-text-black" id="title">
          <h1 class="title has-text-centered is-2 has-text-weight-semibold ">Servicios de red II</h1>
        </a>
        <hr class="has-background-black">
        <div class="columns is-variable is-5 has-text-centered">
          <div class="column is-6">
            <div style="text-align: center;">
              <img src="../assets/images/Labs/ServiciosRedII/srII.png" alt="Servicios de red II" id="post-image">
            </div>
          </div>
          <div class="subtitle column is-5 has-text-left-desktop has-text-left-fullhd has-text-left-tablet has-text-center-mobile" style="text-align: left;">
            
            <p id="description" class="content is-small has-text-weight-medium is-uppercase">
              El laboratorio tiene como objetivo enseñar la enumeración y explotación de tres protocolos de red; NFS (Network File System), SMTP (Simple Mail Transfer Protocol) y MySQL. Los participantes aprenderán a identificar vulnerabilidades y realizar ataques utilizando herramientas comunes en pruebas de penetración y administración de sistemas.
            </p>
            <p class="subtitle is-uppercase is-6 has-text-weight-normal has-text-black-ter">LAB LINK: 
              <b><a href="https://tryhackme.com/r/room/networkservices2" target="page.enlace">Servicios de red II</a></b>
            </p>
            
            <!-- Dificultad -->
            <p class="subtitle is-6 is-uppercase has-text-weight-normal has-text-black-ter">Difficulty: 
              <b>
                <span class="tag difficulty fácil">
                  Fácil
                </span>
              </b>
            </p>

            <!-- Sistema Operativo -->
            

            <!-- Skills -->
            
          </div>
        </div>
        <div class="content has-text-justified-desktop has-text-justified-fullhd has-text-justified has-text-justified-tablet has-text-left-mobile">
          <p><h1 id="protocolo-nfs">Protocolo NFS</h1>

<p><em>Network File System</em> o <em>NFS</em> es un protocolo de red que permite a los sistemas acceder a los archivos de una red, de una manera similar a como acceden a los archivos que tienen en su propio sistema de archivo.</p>

<p>Mediante NFS, tanto los usuarios como los programas pueden acceder a los archivos remotos como si estos fueran locales. Esto se hace montando todo, o una parte de un sistema de archivos en un servidor.</p>

<p>Hace uso del protocolo <strong>RPC</strong> (Remote Procedural Call) para realizar la comunicación cliente-servidor.</p>

<h2 id="como-funciona-nfs">Como funciona NFS</h2>

<p>El servidor NFS configura qué directorios se van a compartir con los clientes en el archivo de configuración <code class="language-plaintext highlighter-rouge">/etc/exports</code>.</p>

<p>Luego estos directorios compartidos se montan en los clientes del servidor NFS mediante el comando <code class="language-plaintext highlighter-rouge">mount &lt;ip_servidor&gt;:/&lt;directorio_compartido&gt; /mnt/&lt;montura_local&gt;</code>.</p>

<p>Una vez montado los directorios compartidos que queremos en nuestro propio equipo podemos ejecutar comandos como → <code class="language-plaintext highlighter-rouge">ls</code>, <code class="language-plaintext highlighter-rouge">cp</code>, <code class="language-plaintext highlighter-rouge">mv</code>, etc.</p>

<h2 id="como-enumerar-el-protocolo-nfs">Como enumerar el protocolo NFS</h2>
<ol>
  <li><strong>Uso del comando showmount:</strong>
  Podemos hacer uso del comando <code>showmount -e ip_servidor</code> para ver los directorios compartidos del servidor.</li><br />
  <li><strong>Uso de la herramienta Nmap:</strong>
    Podemos realizar un escaneo de puertos para ver si está abierto un puerto que haga uso de un servicio NFS.</li><br />
  <li><strong>Uso de rcpinfo:</strong>
    Mediante la herramienta <strong>rcpinfo</strong> podemos obtener información sobre los servicios RPC con el comando <code>rcpinfo -p ip_servidor</code>.</li><br />
  <li><strong>Escaneo manual de Directorios:</strong>
    Como hemos comentado antes, los directorios que un servidor va a compartir se configuran en el fichero <code>/etc/exports</code>, por tanto, si realizamos una lectura del mismo encontraremos que recursos comparten y más información.</li><br />
  <li><strong>Uso del comando nfsstat:</strong>
  Este comando proporciona estadísticas y detalles sobre el servicio NFS.</li>
</ol>

<h2 id="como-explotar-el-protocolo-nfs">Como explotar el protocolo NFS</h2>

<ol>
  <li>
    <p><strong>Comprobar fichero de configuración /etc/exports:</strong></p>

    <p>Como hemos comentado antes, el fichero de configuración <code class="language-plaintext highlighter-rouge">/etc/exports</code> puede contener información valiosa a la hora de explotar NFS. Aquí vamos a encontrar si el recurso que se comparte tiene la opción de configuración <strong>root_squash</strong> activada o no.</p>

    <p>Esta opción hace que cualquier usuario que tenga privilegios root en el sistema local, sea un usuario sin privilegios en el servidor.</p>

    <p>Si no está configurado, es decir, tenemos <strong>no_root_squash</strong> el cliente con privilegios root, tendrá esos permisos en el servidor NFS.</p>

    <p>Aquí podemos encontrar información de como escalar privilegios en NFS → <a href="https://joseeelv.github.io//blog/EPL">Escalar Privilegios</a>.</p>
  </li>
</ol>

<h3 id="ejemplo-práctico">Ejemplo práctico:</h3>

<ol>
  <li>Realizamos un escaneo de puertos de la ip de la máquina víctima y vemos que tenemos un servicio NFS corriendo en el puerto 2049:</li>
</ol>

<div style="text-align:center; ">
  <img src="../assets/images/Labs/ServiciosRedII/Untitled 1.png" alt="Untitled" onclick="openModal(this.src)" />
</div>
<div style="text-align:left; ">
  <table>
    <tr>
      <td style="vertical-align:top;">
      2. Vamos a nuestro directorio <code>/tmp</code> y creamos una nueva montura:
        <div style="text-align:center; width:500px;">
          <img src="../assets/images/Labs/ServiciosRedII/Untitled 2.png" alt="Untitled" onclick="openModal(this.src)" style="width:100%;max-width:500px" />
        </div><br />
      4. Vemos que hay un directorio llamado <code>/.ssh</code> si accedemos a él encontramos los ficheros <strong>id_rsa</strong> y <strong>id_rsa.pub</strong>:
      <div style="text-align:center; ">
        <img src="../assets/images/Labs/ServiciosRedII/Untitled 4.png" alt="Untitled" onclick="openModal(this.src)" style="width:100%;max-width:500px" />
      </div>
      </td>
      <td>
      3. La montamos en nuetra máquina la montura que está compartiendo la máquina víctima, luego nos cambiamos al directorio que tiene dentro la montura, listamos directorios y vemos algunos archivos:
      <div style="text-align:center; ">
        <img src="../assets/images/Labs/ServiciosRedII/Untitled 3.png" alt="Untitled" onclick="openModal(this.src)" style="width:100%;max-width:500px" />
      </div>
      </td>
    </tr>
  </table>
</div>

<ol>
  <li>Ahora podemos realizar la copia de ambos ficheros en nuestra máquina para poder visualizar su contenido, por ejemplo, visualizamos el contenido de <strong>id_rsa.pub</strong> y vemos que <em>cappucino</em> es el usuario del fichero <em>id_rsa</em>.</li>
</ol>
<div style="text-align:center; ">
  <img src="../assets/images/Labs/ServiciosRedII/Untitled 5.png" alt="Untitled" onclick="openModal(this.src)" style="width:100%;max-width:500px" />
</div>

<div style="text-align:left; ">
  <table>
    <tr>
      <td style="vertical-align:top; width:600px">
      6. Tenemos el usuario <em>cappucino</em> y su <strong>id_rsa</strong>, por tanto, podemos realizar la conexión ssh:
      <div style="text-align:center; ">
        <img src="../assets/images/Labs/ServiciosRedII/Untitled 6.png" alt="Untitled" onclick="openModal(this.src)" style="width:100%;max-width:500px" />
      </div>
      7. Ya dentro del servidor podemos ver los recursos que comparte:
      <div style="text-align:center; ">
        <img src="../assets/images/Labs/ServiciosRedII/Untitled 7.png" alt="Untitled" onclick="openModal(this.src)" style="width:100%;max-width:500px" />
      </div>
      Código en C del exploit:
      <pre>int main(){
  setgid(0);
  setuid(0);
  system("/bin/bash -");
  return 0;
}</pre>
      </td>
      <td>
      8. Y vemos que el directorio <code>/home</code> tiene activado el <strong>no_root_squash</strong>, por tanto, si metemos en dicho directorio un script que se ejecute con privilegios root, al no tener dicha configuración activa, si lo ejecutamos seremos un usuario con privilegios root y no uno normal.
      <div style="text-align:center; ">
        <img src="../assets/images/Labs/ServiciosRedII/Untitled 8.png" alt="Untitled" onclick="openModal(this.src)" style="width:100%;max-width:500px" />
      </div>
      </td>
    </tr>
  </table>
</div>

<div style="text-align:left; ">
  <table>
    <tr>
      <td style="vertical-align:top; width:50%;">
        <div style="text-align:center; ">
        9. Incluimos dicho script en el directorio anteriormente comentado:
          <img src="../assets/images/Labs/ServiciosRedII/Untitled 9.png" alt="Untitled" onclick="openModal(this.src)" />
        </div>
      </td>
      <td>
        <div style="text-align:center; ">
        10. Vemos que se ha incluido y solamente  quedaría ejecutarlo:
          <img src="../assets/images/Labs/ServiciosRedII/Untitled 10.png" alt="Untitled" onclick="openModal(this.src)" />
        </div>
      </td>
    </tr>
  </table>
</div>

<ol>
  <li>Finalmente, si hacemos <code class="language-plaintext highlighter-rouge">./exploitNFS</code> escalaremos privilegios y tendremos acceso a la flag.</li>
</ol>

<h1 id="protocolo-smtp">Protocolo SMTP</h1>

<p>El protocolo <em>SMTP</em> (Simple Mail Transfer Protocol) es el estándar utilizado para el envío de correos electrónicos a través de redes IP.</p>

<p>SMTP no maneja ni la recepción ni el almacenamiento de correos, para ello se utilizan otros protocolos como <em>POP3</em> (Post Office Protocol) o <em>IMAP</em> (Internet Message Access Protocol).</p>

<p>Hace uso de un modelo cliente-servidor, donde el cliente envía los correos electrónicos a un servidor SMTP y estos los envía a otros servidores SMTP de destino.</p>

<p>SMTP hace uso del puerto <code class="language-plaintext highlighter-rouge">TCP 25</code> para la conexión entre servidores, pero también usa los puertos <code class="language-plaintext highlighter-rouge">TCP 587</code> (correos con autenticación) y <code class="language-plaintext highlighter-rouge">TCP 465</code> (correo cifrado “smtps”).</p>

<p>Los mensajes en SMTP se envían en texto plano, pero la conexión puede estar cifrada mediante <em>TLS/SSL</em>.</p>

<h2 id="como-funciona-el-protocolo-smtp">Como funciona el protocolo SMTP</h2>

<div style="text-align:center; ">
  <img src="../assets/images/Labs/ServiciosRedII/Untitled 11.png" alt="Untitled" onclick="openModal(this.src)" />
</div>
<ol>
  <li>El cliente establece conexión con el servidor cuando manda un correo electrónico a través del puerto 25 (smtp handshake).</li><br />
  <li>Luego SMTP usa un conjunto de comandos (en texto plano) para la comunicación entre el cliente y servidor, donde el servidor responde con códigos de estado que indica el resultado de la solicitud.</li><br />
  <li>La transferencia de mensajes se realiza después de enviar el comando <code>DATA</code>, si el servidor no puede acceder al cliente destinatario, pone el correo electrónico en <strong>SMTP queue</strong>.</li><br />
  <li>La conexión se cierra cuando el cliente hace uso del comando <code>QUIT</code>.</li><br />
</ol>

<h2 id="como-enumerar-el-protocolo-smtp">Como enumerar el protocolo SMTP</h2>

<ol>
  <li>
    <p><strong>Conexión Telnet manual:</strong></p>

    <p>Primero realizamos una conexión mediante Telnet:</p>
  </li>
</ol>
<div style="text-align:center;">
  <pre><code>
telnet ip-servidor 25
telnet ip-servidor 587 //si es con autenticación
  </code></pre>
</div>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Luego, podemos enviar comandos SMTP:
</code></pre></div></div>

<div style="text-align:left;">
  <pre><code>
EHLO ejemplo.com
VRFY user@example.com
EXPN list@example.com
QUIT
  </code></pre>
</div>

<ol>
  <li>
    <p><strong>Uso de la herramienta Nmap con scripts SMTP:</strong></p>

    <p>Como hemos hecho en otros protocolos, podemos hacer uso de:</p>
  </li>
</ol>
<div style="text-align:center;">
  <pre><code>
nmap -p 25 --script smtp-enum <ip-servidor>
  &lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
    <strong>Scripts Útiles de Nmap para SMTP:</strong><br />
  <ul>
  <li><strong>smtp-enum</strong>: Enumera los usuarios y dominios disponibles.</li>
  <li><strong>smtp-commands</strong>: Enumera los comandos soportados por el servidor SMTP.</li>
  <li><strong>smtp-vrfy</strong>: Verifica si el servidor acepta la verificación de usuarios.</li>
  <li><strong>smtp-open-relay</strong>: Comprueba si el servidor es un relay abierto.</li>
</ul>
1. <strong>Uso del comando smtp-user-enum:</strong>
    
    `smtp-user-enum` es una herramienta diseñada para enumerar usuarios en servidores SMTP, para ello podemos hacer uso de:
    
<div style="text-align:center;">
  <pre><code>
smtp-user-enum -M VRFY -U listausuario.txt -t <ip-servidor>
  &lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
<ul>
    <li><code>-M VRFT</code>: Usamos el comando `VRFY` para enumerar servicios.</li>
    <li><code>-U listausuario.txt</code>: Especifica el archivo de texto que contiene la lista de usuarios a probar.</li>
    <li><code>-t ip-servidor</code>: Especifica la ip del servidor SMTP.</li>
</ul>
1. <strong>Uso de Metasploit framework:</strong>
    Metasploit Framework incluye módulos para enumerar y explotar servicios SMTP.
2. <strong>Uso de smtp-cli:</strong>
    
    `smtp-cli`: es una herramienta de línea de comandos para probar servidores SMTP y enviar correos electrónicos desde una línea de comando.
    

## Como explotar el protocolo SMTP

1. <strong>Ataque de fuerza bruta:</strong>
    
    Mediante `hydra` podemos realizar una ataque de fuerza bruta si contamos con el *username* de un usuario y un diccionario; por ejemplo *rockyou.txt*.  
<div style="text-align:center;">
  <pre><code>
hydra -t 16 -l <username> -P <ruta_diccionario> -vV <ip-servidor> [protocolo]
  &lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
<ul>  
  <li><code>-t 16</code>: número de conexiones paralelas por objetivo, en este caso 16.</li>
  <li><code>-l username</code>: Nombre de usuario a atacar.</li>
  <li><code>-P ruta_diccionario</code>: Ruta del diccionario, por ejemplo /usr/share/wordlists/rockyou.txt.</li>
  <li><code>-vV</code>: Pone el verbose a *very verbose* mostrando login+pass cada vez que realiza un intento.</li>
  <li><code>ip-servidor</code>: Indica la dirección IP del servidor.</li>
  <li><code>[protocolo]</code>: Añade el protocolo, por ejemplo ssh.</li>
</ul>
### Ejemplo práctico:

1. Realizamos un escaneo de los puertos de la red para ver cuales están abiertos y que servicios están corriendo:

<div style="text-align:left;">
  <table>
    <tr>
      <td>
        <div style="text-align:center; ">
          <img src="../assets/images/Labs/ServiciosRedII/Untitled 12.png" alt="Untitled" onclick="openModal(this.src)" />
        </div>
      </td>
      <td>
      <div style="text-align:center; ">
        <img src="../assets/images/Labs/ServiciosRedII/Untitled 13.png" alt="Untitled" onclick="openModal(this.src)" style="width:75%" />
      </div>
      </td>
    </tr>
  </table>
</div>

2. No encontramos nada, pero sabemos que podemos hacer uso de metasploit, con `msfconsole` activamos la herramienta y vamos a buscar exploits sobre “mstp_version”:

<div style="text-align:left;">
  <table>
    <tr>
      <td style="vertical-align:top; width:650px">
        <div style="text-align:center;">
        2.1 Mediante <code>search nombre_modulo</code> realizamos una búsqueda de los exploits:
          <img src="../assets/images/Labs/ServiciosRedII/Untitled 14.png" alt="Untitled" onclick="openModal(this.src)" style="width:100%;max-width:500px" />
        </div>
      </td>
      <td style="vertical-align:top;">
      <div style="text-align:center; ">
      2.2 Mediante <code>options modulo</code> podemos listar las opciones que tiene el exploit:
        <img src="../assets/images/Labs/ServiciosRedII/Untitled 15.png" alt="Untitled" onclick="openModal(this.src)" style="width:100%;max-width:500px" />
      </div>
      </td>
    </tr>
  </table>
</div>

<p>Vamos a especificar el host, en este caso será la ip de la maquina victima, lo hacemos mediante el comando <code>set [opcion] valor</code>, en nuestro caso → <code>set RHOSTS ip-maquina</code>.</p>

<div style="text-align:center;">2.3 Ahora, lo ejecutamos con <code>run</code>:</div>
<div style="text-align:center; vertical-align:top;">
  <img src="../assets/images/Labs/ServiciosRedII/Untitled 16.png" alt="Untitled" onclick="openModal(this.src)" />
</div>

Vemos que el MTA de *polosmtp.home* es Postfix.

3. Ahora, con metasploit podemos enumerar los usuarios del servicio smtp → `search smtp_enum`

<div style="text-align:left;">
  <table>
    <tr>
      <td style="vertical-align:top; width:650px">
        <div style="text-align:center; ">
        3.1 Vemos las opciones que tiene el exploit:
          <img src="../assets/images/Labs/ServiciosRedII/Untitled 17.png" alt="Untitled" onclick="openModal(this.src)" style="width:100%;max-width:500px" />
        </div>
      </td>
      <td style="vertical-align:top;">
      <div style="text-align:center; ">
        3.2 Añadimos las opciones necesarias para que se pueda ejecutar:
        <img src="../assets/images/Labs/ServiciosRedII/Untitled 18.png" alt="Untitled" onclick="openModal(this.src)" style="width:100%;max-width:500px" />
      </div>
      Ahora tenemos que especificar tanto el <code>RHOST</code> (igual que antes) como <code>USER_FILE</code> (diccionario con usernames).<br />
      Si no tienes el diccionario instalado, haz → <code>sudo apt install seclists -y</code>.<br />Añadimos el diccionario y ejecutamos.<br />
      Hemos encontrado a los usuarios, en este caso solamente existe el administrador.
      </td>
    </tr>
  </table>
</div>

4. Ahora, si vemos el escaneo de puertos, vemos que hay un servicio ssh corriendo, por tanto, vamos a realizar una ataque de fuerza bruta para conseguir la contraseña del usuario <em>administrator</em>:

<div style="text-align:center; ">
  <img src="../assets/images/Labs/ServiciosRedII/Untitled 19.png" alt="Untitled" onclick="openModal(this.src)" />
</div>

<table>
  <tr>
    <td style="vertical-align:top; width:600px">
      <div style="text-align:center; ">
      5. Conseguimos la contraseña y realizamos la conexión ssh con las credenciales:
        <img src="../assets/images/Labs/ServiciosRedII/Untitled 20.png" alt="Untitled" onclick="openModal(this.src)" style="width:100%;max-width:500px" />
      </div>
    </td>
    <td style="width:550px; text-align:center;">
      <div style="text-align:center;">
      6. Dentro del servidor buscamos la flag:
        <img src="../assets/images/Labs/ServiciosRedII/Untitled 21.png" alt="Untitled" onclick="openModal(this.src)" style="width:100%;max-width:500px" />
      </div>
    </td>
  </tr>
</table>

# Gestión de bases de datos relacionales MySQL

*MySQL* es un gestor de bases de datos relacionales (RDBMS), basado en un Lenguaje Estructurado mediante Consultas (Structured Query Language) ampliamente utilizado para almacenar, gestionar y recuperar datos en aplicaciones web y sistemas empresariales. 

Un uso muy común de MySQL sería la de una base de datos para back end.

Hace uso del puerto `TCP 3306`.

## Como funciona MySQL

El servidor SQL puede realizar consultas a la base de datos, modificarla, crear nuevas o eliminar bases de datos ya existente.

Aquí podemos encontrar más información sobre [SQL](https://dev.mysql.com/doc/dev/mysql-server/latest/PAGE_SQL_EXECUTION.html)

## Como enumerar MySQL

1. <strong>Uso de la herramienta Nmap:</strong>
    
<div style="text-align:center;">
  <pre><code>
nmap -p 3306 --script=mysql-info <target>
  &lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
Este comando escanea el puerto 3306 (puerto predeterminado para MySQL) e intenta identificar información sobre el servicio MySQL.    

## Como explotar MySQL

1. <strong>Realizar una inyección SQL (SQLi):</strong>
    
    Podemos buscar puntos de entrada donde se ingresan datos que se utilizan directamente en consultas SQL. Por ejemplo, formularios web, parámetros de URL, etc.
    
    Podemos ver más información sobre este tipo de ataque en → [Introducción a las SQL injection](https://joseeelv.github.io//blog/IntroSQLi).
    
2. <strong>Explotación de Configuración Incorrecta:</strong>
    
    Podemos comprobar si el servidor MySQL está configurado sin una contraseña para el usuario root:
    
<div style="text-align:center;">
  <pre><code>
mysql -u root
  </code></pre>
</div> 
    También podemos comprobar si un usuario tiene privilegios elevados sin necesidad, si este puede realizar consultas privilegiadas:
    
<div style="text-align:center;">
  <pre><code>
GRANT ALL PRIVILEGES ON *.* TO 'usuario'@'localhost' WITH GRANT OPTION;
  </code></pre>
</div>

3. <strong>Explotación de Vulnerabilidades Conocidas</strong>
    
    Podemos hacer uso de vulnerabilidades conocidas <strong>CVEs</strong> si el servidor no ha sido actualizado.
    También algunos plugins de MySQL pueden contener vulnerabilidades que pueden ser explotadas si el servidor MySQL está mal configurado.
    
### Ejemplo práctico:

1. Realizamos un escaneo de la red:<br />
<div style="text-align:center;">
  <pre>sudo nmap -p- -sS -sV -sC -n -Pn -vvv --min-rate 5000 ip_maquina</pre>
</div>
<div style="text-align:center; ">
  <img src="../assets/images/Labs/ServiciosRedII/Untitled 23.png" alt="Untitled" onclick="openModal(this.src)" style="width:50%" />
</div><br />
Vemos que en el puerto 3306 tenemos un servicio corriendo, para poder explotarlo podemos hacer uso de metasploit.

2. Hacemos uso de `Mestasploit framework`:

<div style="text-align:left;">
  <table>
    <tr>
      <td style="vertical-align:top; width:650px">
        <div style="text-align:center; ">
        2.1 Buscamos el exploit:
          <img src="../assets/images/Labs/ServiciosRedII/Untitled 24.png" alt="Untitled" onclick="openModal(this.src)" />
        </div>
        2.3 Ponemos las opciones que nos faltan para que el exploit funcione:
        <ul>
          <li> <code>set userane root</code></li>
          <li> <code>set password password</code></li>
          <li> <code>set rhosts ip-victima</code></li>
        </ul>
      </td>
      <td style="vertical-align:top;">
        <div style="text-align:center; ">
        2.2 Vemos las opciones que faltan:
          <img src="../assets/images/Labs/ServiciosRedII/Untitled 25.png" alt="Untitled" onclick="openModal(this.src)" />
        </div>
      </td>
    </tr>
  </table>
</div>

3. Ejecutamos el exploit con `run` y obtenemos la versión de la base de datos:

<div style="text-align:center; ">
  <img src="../assets/images/Labs/ServiciosRedII/Untitled 26.png" alt="Untitled" onclick="openModal(this.src)" />
</div>

4. Ahora, vamos a mostrar las bases de datos → `set sql "show databases"` 

<div style="text-align:center; ">
  <img src="../assets/images/Labs/ServiciosRedII/Untitled 27.png" alt="Untitled" onclick="openModal(this.src)" />
  
  Encontramos 4 bases de datos.
</div>


5. Ahora que tenemos enumerado el servicio SQL, vamos a explotarlo:<br />
<div style="text-align:left;">
  <table>
    <tr>
      <td style="vertical-align:top; width:650px">
        <div style="text-align:center; ">
          5.1 Para ello, vamos a dumpear las bases de datos con el módulo → <code>/mysql/msql_schemadump</code>
          <img src="../assets/images/Labs/ServiciosRedII/Untitled 28.png" alt="Untitled" onclick="openModal(this.src)" />
        </div>
        Especificamos las opciones para poder correr el exploit (como arriba) y lo ejecutamos y nos muestra todas las tablas que hay en la base de datos.
      </td>
      <td style="vertical-align:top;">
        <div style="text-align:center; ">
        5.2 Ejecutamos el exploit:
          <img src="../assets/images/Labs/ServiciosRedII/Untitled 29.png" alt="Untitled" onclick="openModal(this.src)" />
        </div>
      </td>
    </tr>
  </table>
</div>

Como resultado tenemos los creadores de las bases de datos junto con sus password, pero esta está cifrada con hash:
<div style="text-align:center; ">
  <img src="../assets/images/Labs/ServiciosRedII/Untitled 30.png" alt="Untitled" onclick="openModal(this.src)" />
</div>

6. Vemos que hay un usuario ‘*carl*’,que no es un usuario por defecto, y tenemos su password hasheada, por tanto la vamos a guardar en un fichero para descifrarla.<br />
Para ello, copiamos el hash en nuestra máquina y mediante `JohnTheRipper` y un diccionario la vamos a descrifrar:
<div style="text-align:center; ">
  <img src="../assets/images/Labs/ServiciosRedII/Untitled 31.png" alt="Untitled" onclick="openModal(this.src)" />
</div>


- <strong>Password descifrada con JohnTheRipper</strong> → doggie
    

7. Ahora vamos a acceder a la base de datos vía **SSH** con las credenciales del usuario *carl* ya que tenemos un servicio corriendo:<br />
Finalmente, buscando entre los directorios encontramos la flag.
<div style="text-align:center; ">
  <img src="../assets/images/Labs/ServiciosRedII/Untitled 32.png" alt="Untitled" onclick="openModal(this.src)" />
</div>

---
</target></code></pre></div></ip-servidor></ruta_diccionario></username></code></pre></div></ip-servidor></code></pre></div></ip-servidor></code></pre></div>
</p>
        </div>
        
        <div class="disqus-comments" id="disqus_thread"></div>
        
      </div>
    </div>
  </section>
  <footer id="footer">
    <!--Footer Button-->
    <div class="container has-text-centered has-background-grey-darker" id="backtotop">
        <a class="has-text-white" onclick="window.scroll(0,0)">BACK TO TOP</a>
    </div>
    <!--Footer Main Section-->
    <!-- <div class="has-background-grey-darker">
        <div class="container columns">
            Name Section-->
            <!-- <div class="column has-text-left-desktop has-text-centered-mobile">
                <a href="http://localhost:4000/#about">
                    <div class="columns">
                        <div class="column is-one-fifth-desktop is-one-fifth-fullhd is-one-quarter-tablet">
                            <figure class="image is-64x64">
                                <img class="is-rounded" src="/assets/images/me.png">
                            </figure>
                        </div>
                        <div class="column is-marginless">
                            <h5 class="has-text-grey-lighter">Jose Luis Venega</h5>
                            <div class="content has-text-grey">
                                <p>Hi! I'm Jose Luis Venega, a Computer Engineering student at the Universi...</p>
                            </div>
                        </div>
                    </div>
                </a>
            </div> -->

            <!--Link Section
            <div class="column has-text-white">
                <h3>More Links</h3>
                
                <li>
                    <a target="_blank" href="http://localhost:4000/feed.xml">Subscribe via RSS</a>
                </li>
            </div> -->

            <!--Blog-post Section-->
            <!-- <div class="column has-text-white">
                <h3>Recent Posts</h3>
                
                <li>
                    <a href="http://localhost:4000/blog/LinkVortex">LinkVortex</a>
                </li>
                
                <li>
                    <a href="http://localhost:4000/blog/Cicada">Cicada</a>
                </li>
                
                <li>
                    <a href="http://localhost:4000/blog/Chemistry">Chemistry</a>
                </li>
                
            </div>
        </div> -->
    </div>
    <div class="has-background-black has-text-centered has-text-white" id="credits">
        <i class="far fa-copyright"></i> 2025 | A Theme made by <a href="https://github.com/Joseeelv" target="_blank" rel="noopener noreferrer">Joseeelv</a> Powered by <a href="https://jekyllrb.com/" target="_blank">Jekyll</a>
    </div>
</footer>

  <!-- Modal -->
  <div id="myModal" class="modal">
    <span class="close" onclick="closeModal()">&times;</span>
    <img class="modal-content" id="img01">
  </div>

  <!-- Prism.js Script -->
  <script src="../prism.js"></script>
  <script>
    function copyToClipboard(event) {
      const button = event.target;
      const codeContainer = button.closest('.code-container');
      const codeElement = codeContainer.querySelector('code');
    
      if (!codeElement) {
        console.error('No se encontró el elemento <code> para copiar.');
        return;
      }

      const code = codeElement.textContent;

      navigator.clipboard.writeText(code).then(() => {
        button.textContent = 'Copied!';

        setTimeout(() => {
          button.textContent = 'Copy';
        }, 2000); // 2000 ms = 2 segundos

      }).catch(err => {
        console.error('Error al copiar al portapapeles: ', err);
      });
    }

    document.querySelectorAll('.copy-button').forEach(button => {
      button.addEventListener('click', copyToClipboard);
    });

    function openModal(imgSrc) {
      var modal = document.getElementById("myModal");
      var modalImg = document.getElementById("img01");

      modal.style.display = "block";
      setTimeout(function() {
        modal.classList.add('show');
      }, 10); // Delay to trigger the animation
      modalImg.src = imgSrc;
    }

    function closeModal(event) {
      if (event) event.stopPropagation();
      var modal = document.getElementById("myModal");
      modal.classList.remove('show');
      setTimeout(function() {
        modal.style.display = "none";
      }, 300); // Match this duration with the CSS animation duration
    }

    window.onclick = function(event) {
      var modal = document.getElementById("myModal");
      if (event.target == modal) {
        closeModal();
      }
    }
  </script>
</body>
</html>
